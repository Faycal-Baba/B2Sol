package B.generator.generator.util;

/*Generated by MPS */

import java.util.List;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.Map;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.Iterator;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import B.behavior.StructSet__BehaviorDescriptor;
import java.util.HashMap;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public class Util {

  public static List<SNode> outputparamlist;

  public static int structCounter = 1;

  public static Map<SNode, String> structNames;

  public static String structName = "struct_def_";


  public Util() {
    outputparamlist = new ArrayList<SNode>();
  }

  public static boolean isPayable(SNode operation) {
    for (SNode st : ListSequence.fromList(SLinkOperations.getChildren(operation, LINKS.body$4v9z))) {
      if (st instanceof SNode) {
        SNode node = ((SNode) st);
        if (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(node, LINKS.to$g5So), CONCEPTS.THIS$mL)) {
          return true;
        }
      }
      if (st instanceof SNode) {
        SNode node = ((SNode) st);
        boolean payable = isPayable(SLinkOperations.getChildren(node, LINKS.instrs$CWJX));
        if (payable == true) {
          return payable;
        }
      } else if (SNodeOperations.isInstanceOf(st, CONCEPTS.IfInstruction$dN)) {
        SNode node = ((SNode) st);
        boolean payable = isPayable(SLinkOperations.getChildren(node, LINKS.IfTrueBranch$4$iY));
        if (payable == true) {
          return true;
        }
        {
          Iterator<SNode> elseIf__it = ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.elseIfs$8mi0)).iterator();
          SNode elseIf__var;
          while (elseIf__it.hasNext()) {
            elseIf__var = elseIf__it.next();
            payable = isPayable(SLinkOperations.getChildren(elseIf__var, LINKS.instr$QmAM));
            if (payable = true) {
              return payable;
            }
          }
        }
        if (!(ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.ElseBranch$4DVm)).isEmpty())) {
          payable = isPayable(SLinkOperations.getChildren(node, LINKS.ElseBranch$4DVm));
          if (payable == true) {
            return payable;
          }
        }
      }
    }
    return false;
  }

  public static boolean isPayable(List<SNode> instrs) {
    for (SNode st_ : ListSequence.fromList(instrs)) {
      if (SNodeOperations.isInstanceOf(st_, CONCEPTS.TransferOperation$Fn)) {
        SNode nodeBis = ((SNode) st_);
        if (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(nodeBis, LINKS.to$g5So), CONCEPTS.THIS$mL)) {
          return true;
        }
      } else if (SNodeOperations.isInstanceOf(st_, CONCEPTS.VarIn$_L)) {
        SNode node = ((SNode) st_);
        boolean payable = isPayable(SLinkOperations.getChildren(node, LINKS.instrs$CWJX));
        if (payable == true) {
          return payable;
        }
      } else if (SNodeOperations.isInstanceOf(st_, CONCEPTS.IfInstruction$dN)) {
        SNode node = ((SNode) st_);
        boolean payable = isPayable(SLinkOperations.getChildren(node, LINKS.IfTrueBranch$4$iY));
        if (payable == true) {
          return true;
        }
        {
          Iterator<SNode> elseIf__it = ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.elseIfs$8mi0)).iterator();
          SNode elseIf__var;
          while (elseIf__it.hasNext()) {
            elseIf__var = elseIf__it.next();
            payable = isPayable(SLinkOperations.getChildren(elseIf__var, LINKS.instr$QmAM));
            if (payable = true) {
              return payable;
            }
          }
        }
        if (!(ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.ElseBranch$4DVm)).isEmpty())) {
          payable = isPayable(SLinkOperations.getChildren(node, LINKS.ElseBranch$4DVm));
          if (payable == true) {
            return payable;
          }
        }
      }
    }
    return false;
  }

  public static String getName(SNode set) {
    if (structNames == null) {
      return setName(set);
    } else {
      if (checkIfSetExists(set)) {
        for (SNode e : SetSequence.fromSet(MapSequence.fromMap(structNames).keySet())) {
          if ((boolean) StructSet__BehaviorDescriptor.equals_id7E1Po1byfmE.invoke(e, set)) {
            return MapSequence.fromMap(structNames).get(e);
          }
        }
      }
    }
    String newStructName = structName + structCounter;
    structCounter++;
    MapSequence.fromMap(structNames).put(set, newStructName);
    return newStructName;
  }



  public static String setName(SNode newStruct) {
    if (structNames == null) {
      structNames = MapSequence.fromMap(new HashMap<SNode, String>());
    }
    String name = structName + structCounter;
    structCounter++;
    MapSequence.fromMap(structNames).put(newStruct, name);
    return name;
  }

  public static boolean checkIfSetExists(SNode structSet) {
    for (SNode e : SetSequence.fromSet(MapSequence.fromMap(Util.structNames).keySet())) {
      if ((boolean) StructSet__BehaviorDescriptor.equals_id7E1Po1byfmE.invoke(structSet, e)) {
        return true;
      }
    }
    return false;
  }
  public static void clearMemory() {
    structCounter = 1;
    structNames = MapSequence.fromMap(new HashMap<SNode, String>());
  }

  public static boolean isSolEnvVar(SNode id) {
    switch (SPropertyOperations.getString(id, PROPS.name$MnvL)) {
      case "msg_sender":
        return true;
      case "msg_value":
        return true;
      case "block_timestamp":
        return true;
      default:
        return false;
    }
  }


  private static final class LINKS {
    /*package*/ static final SContainmentLink to$g5So = MetaAdapterFactory.getContainmentLink(0x17157e91c2e440eaL, 0xaefc3d3bbdd08639L, 0x3d1067ce476396f5L, 0x3d1067ce476396feL, "to");
    /*package*/ static final SContainmentLink instrs$CWJX = MetaAdapterFactory.getContainmentLink(0x17157e91c2e440eaL, 0xaefc3d3bbdd08639L, 0x7923cf0b1219a72L, 0x7923cf0b1219a75L, "instrs");
    /*package*/ static final SContainmentLink IfTrueBranch$4$iY = MetaAdapterFactory.getContainmentLink(0x17157e91c2e440eaL, 0xaefc3d3bbdd08639L, 0x7d382cf97c7d3d4dL, 0x7d382cf97c7d49ddL, "IfTrueBranch");
    /*package*/ static final SContainmentLink elseIfs$8mi0 = MetaAdapterFactory.getContainmentLink(0x17157e91c2e440eaL, 0xaefc3d3bbdd08639L, 0x7d382cf97c7d3d4dL, 0x1ace29e015cd441bL, "elseIfs");
    /*package*/ static final SContainmentLink instr$QmAM = MetaAdapterFactory.getContainmentLink(0x17157e91c2e440eaL, 0xaefc3d3bbdd08639L, 0x1ace29e015cd4415L, 0x1ace29e015cd4418L, "instr");
    /*package*/ static final SContainmentLink ElseBranch$4DVm = MetaAdapterFactory.getContainmentLink(0x17157e91c2e440eaL, 0xaefc3d3bbdd08639L, 0x7d382cf97c7d3d4dL, 0x7d382cf97c7d49e0L, "ElseBranch");
    /*package*/ static final SContainmentLink body$4v9z = MetaAdapterFactory.getContainmentLink(0x17157e91c2e440eaL, 0xaefc3d3bbdd08639L, 0x6d3985c698aa2036L, 0x6d3985c698ada6a2L, "body");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept THIS$mL = MetaAdapterFactory.getConcept(0x17157e91c2e440eaL, 0xaefc3d3bbdd08639L, 0x5b77dc1122c9701L, "B.structure.THIS");
    /*package*/ static final SConcept IfInstruction$dN = MetaAdapterFactory.getConcept(0x17157e91c2e440eaL, 0xaefc3d3bbdd08639L, 0x7d382cf97c7d3d4dL, "B.structure.IfInstruction");
    /*package*/ static final SConcept TransferOperation$Fn = MetaAdapterFactory.getConcept(0x17157e91c2e440eaL, 0xaefc3d3bbdd08639L, 0x3d1067ce476396f5L, "B.structure.TransferOperation");
    /*package*/ static final SConcept VarIn$_L = MetaAdapterFactory.getConcept(0x17157e91c2e440eaL, 0xaefc3d3bbdd08639L, 0x7923cf0b1219a72L, "B.structure.VarIn");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}
